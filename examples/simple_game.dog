// ã‚·ãƒ³ãƒ—ãƒ«ã‚²ãƒ¼ãƒ é›† - Dogè¨€èª
// æ•°å½“ã¦ã‚²ãƒ¼ãƒ ã€ã˜ã‚ƒã‚“ã‘ã‚“ã€ç°¡å˜ãªRPGè¦ç´ ã‚’å«ã‚€ã‚²ãƒ¼ãƒ å®Ÿè£…

puts("=== Dogè¨€èª ã‚·ãƒ³ãƒ—ãƒ«ã‚²ãƒ¼ãƒ é›† ===");
puts("");

// ===== 1. æ•°å½“ã¦ã‚²ãƒ¼ãƒ  =====
puts("ã€1. æ•°å½“ã¦ã‚²ãƒ¼ãƒ ã€‘");
puts("");

let number_guessing_game = fn(target, max_attempts) {
    puts("ğŸ¯ æ•°å½“ã¦ã‚²ãƒ¼ãƒ é–‹å§‹!");
    puts("1ã‹ã‚‰100ã¾ã§ã®æ•°ã‚’å½“ã¦ã¦ãã ã•ã„");
    puts("æœ€å¤§è©¦è¡Œå›æ•°: " + max_attempts);
    puts("ç›®æ¨™æ•°å­—: " + target + " (æœ¬æ¥ã¯éš ã•ã‚Œã‚‹)");
    puts("");
    
    // äºˆã‚å®šç¾©ã•ã‚ŒãŸæ¨æ¸¬å€¤ï¼ˆå®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰
    let guesses = [50, 75, 87, 93, 90, 88, 89];
    let attempt = 1;
    
    while (attempt <= max_attempts && attempt <= len(guesses)) {
        let guess = guesses[attempt - 1];
        puts("ç¬¬" + attempt + "å›ç›®ã®æ¨æ¸¬: " + guess);
        
        if (guess == target) {
            puts("ğŸ‰ æ­£è§£! " + attempt + "å›ç›®ã§å½“ãŸã‚Šã¾ã—ãŸ!");
            puts("ã‚¹ã‚³ã‚¢: " + (max_attempts - attempt + 1) * 10 + "ç‚¹");
            return attempt;
        } else if (guess < target) {
            puts("ğŸ“ˆ ã‚‚ã£ã¨å¤§ãã„æ•°ã§ã™");
        } else {
            puts("ğŸ“‰ ã‚‚ã£ã¨å°ã•ã„æ•°ã§ã™");
        };
        
        attempt = attempt + 1;
    };
    
    puts("ğŸ’” æ®‹å¿µ! " + max_attempts + "å›ä»¥å†…ã«å½“ã¦ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸ");
    puts("æ­£è§£ã¯ " + target + " ã§ã—ãŸ");
    return -1;
};

// ãƒ©ãƒ³ãƒ€ãƒ é¢¨æ•°å€¤ç”Ÿæˆï¼ˆæ“¬ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
let pseudo_random = fn(seed, min, max) {
    let new_seed = (seed * 1103515245 + 12345) % 1000000;
    return min + (new_seed % (max - min + 1));
};

puts("æ•°å½“ã¦ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤:");
let random_target = pseudo_random(42, 1, 100);
number_guessing_game(random_target, 7);
puts("");

// ===== 2. ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ  =====
puts("ã€2. ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ ã€‘");
puts("");

let rock_paper_scissors = fn(rounds) {
    puts("âœ‚ï¸ ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ é–‹å§‹!");
    puts("ãƒ©ã‚¦ãƒ³ãƒ‰æ•°: " + rounds);
    puts("");
    
    let choices = ["ã‚°ãƒ¼", "ãƒãƒ§ã‚­", "ãƒ‘ãƒ¼"];
    let player_score = 0;
    let computer_score = 0;
    let ties = 0;
    
    // äºˆã‚å®šç¾©ã•ã‚ŒãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é¸æŠ
    let player_moves = ["ã‚°ãƒ¼", "ãƒãƒ§ã‚­", "ãƒ‘ãƒ¼", "ã‚°ãƒ¼", "ãƒ‘ãƒ¼"];
    let seed = 123;
    
    let round = 1;
    while (round <= rounds && round <= len(player_moves)) {
        puts("--- ãƒ©ã‚¦ãƒ³ãƒ‰ " + round + " ---");
        
        let player_choice = player_moves[round - 1];
        
        // ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®é¸æŠï¼ˆæ“¬ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
        seed = pseudo_random(seed, 1, 1000);
        let computer_index = seed % 3;
        let computer_choice = choices[computer_index];
        
        puts("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: " + player_choice);
        puts("ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿: " + computer_choice);
        
        // å‹æ•—åˆ¤å®š
        let result = "";
        if (player_choice == computer_choice) {
            result = "å¼•ãåˆ†ã‘";
            ties = ties + 1;
        } else if (
            (player_choice == "ã‚°ãƒ¼" && computer_choice == "ãƒãƒ§ã‚­") ||
            (player_choice == "ãƒãƒ§ã‚­" && computer_choice == "ãƒ‘ãƒ¼") ||
            (player_choice == "ãƒ‘ãƒ¼" && computer_choice == "ã‚°ãƒ¼")
        ) {
            result = "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹ã¡";
            player_score = player_score + 1;
        } else {
            result = "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å‹ã¡";
            computer_score = computer_score + 1;
        };
        
        puts("çµæœ: " + result);
        puts("");
        round = round + 1;
    };
    
    puts("=== æœ€çµ‚çµæœ ===");
    puts("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: " + player_score + "å‹");
    puts("ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿: " + computer_score + "å‹");
    puts("å¼•ãåˆ†ã‘: " + ties + "å›");
    
    if (player_score > computer_score) {
        puts("ğŸ† ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç·åˆå‹åˆ©!");
    } else if (computer_score > player_score) {
        puts("ğŸ¤– ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ç·åˆå‹åˆ©!");
    } else {
        puts("ğŸ¤ ç·åˆå¼•ãåˆ†ã‘!");
    };
    
    return {"player": player_score, "computer": computer_score, "ties": ties};
};

puts("ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤:");
rock_paper_scissors(5);
puts("");

// ===== 3. ç°¡å˜ãªRPGæˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ  =====
puts("ã€3. ç°¡å˜ãªRPGæˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ã€‘");
puts("");

// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½œæˆ
let create_character = fn(name, hp, attack, defense) {
    return {
        "name": name,
        "max_hp": hp,
        "hp": hp,
        "attack": attack,
        "defense": defense,
        "level": 1,
        "exp": 0
    };
};

// ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
let calculate_damage = fn(attacker, defender) {
    let base_damage = attacker["attack"] - defender["defense"];
    if (base_damage < 1) {
        base_damage = 1;  // æœ€ä½ãƒ€ãƒ¡ãƒ¼ã‚¸
    };
    
    // ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ï¼ˆ80-120%ï¼‰
    let seed = attacker["attack"] + defender["defense"];
    let random_factor = 80 + (pseudo_random(seed, 1, 100) % 41);
    let damage = (base_damage * random_factor) / 100;
    
    return damage;
};

// æ”»æ’ƒå‡¦ç†
let attack_character = fn(attacker, defender) {
    let damage = calculate_damage(attacker, defender);
    defender["hp"] = defender["hp"] - damage;
    
    if (defender["hp"] < 0) {
        defender["hp"] = 0;
    };
    
    puts(attacker["name"] + " ã®æ”»æ’ƒ!");
    puts(defender["name"] + " ã« " + damage + " ã®ãƒ€ãƒ¡ãƒ¼ã‚¸!");
    puts(defender["name"] + " HP: " + defender["hp"] + "/" + defender["max_hp"]);
    
    return damage;
};

// å›å¾©å‡¦ç†
let heal_character = fn(character, amount) {
    character["hp"] = character["hp"] + amount;
    if (character["hp"] > character["max_hp"]) {
        character["hp"] = character["max_hp"];
    };
    
    puts(character["name"] + " ã¯ " + amount + " å›å¾©ã—ãŸ!");
    puts(character["name"] + " HP: " + character["hp"] + "/" + character["max_hp"]);
};

// æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ 
let battle = fn(player, enemy) {
    puts("âš”ï¸ æˆ¦é—˜é–‹å§‹!");
    puts(player["name"] + " vs " + enemy["name"]);
    puts("");
    
    let turn = 1;
    let max_turns = 20;  // ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢
    
    while (player["hp"] > 0 && enemy["hp"] > 0 && turn <= max_turns) {
        puts("--- ã‚¿ãƒ¼ãƒ³ " + turn + " ---");
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³
        if (player["hp"] > 0) {
            // ç°¡å˜ãªAI: HPãŒ30%ä»¥ä¸‹ãªã‚‰å›å¾©ã€ãã†ã§ãªã‘ã‚Œã°æ”»æ’ƒ
            if (player["hp"] < player["max_hp"] / 3 && turn % 4 == 1) {
                heal_character(player, 20);
            } else {
                attack_character(player, enemy);
            };
        };
        
        if (enemy["hp"] <= 0) {
            break;
        };
        
        puts("");
        
        // æ•µã®ã‚¿ãƒ¼ãƒ³
        if (enemy["hp"] > 0) {
            attack_character(enemy, player);
        };
        
        puts("");
        turn = turn + 1;
    };
    
    puts("=== æˆ¦é—˜çµ‚äº† ===");
    if (player["hp"] > 0) {
        puts("ğŸ† " + player["name"] + " ã®å‹åˆ©!");
        let exp_gained = enemy["level"] * 10;
        player["exp"] = player["exp"] + exp_gained;
        puts("çµŒé¨“å€¤ " + exp_gained + " ã‚’ç²å¾—!");
        return true;
    } else {
        puts("ğŸ’€ " + player["name"] + " ã®æ•—åŒ—...");
        return false;
    };
};

puts("RPGæˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¢:");
let hero = create_character("å‹‡è€…", 100, 25, 5);
let monster = create_character("ãƒ‰ãƒ©ã‚´ãƒ³", 80, 20, 3);

puts("ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±:");
puts(hero["name"] + " - HP:" + hero["hp"] + " ATK:" + hero["attack"] + " DEF:" + hero["defense"]);
puts(monster["name"] + " - HP:" + monster["hp"] + " ATK:" + monster["attack"] + " DEF:" + monster["defense"]);
puts("");

battle(hero, monster);
puts("");

// ===== 4. è¿·è·¯ã‚²ãƒ¼ãƒ ï¼ˆç°¡æ˜“ç‰ˆï¼‰ =====
puts("ã€4. è¿·è·¯ã‚²ãƒ¼ãƒ ï¼ˆç°¡æ˜“ç‰ˆï¼‰ã€‘");
puts("");

// è¿·è·¯ã®ä½œæˆï¼ˆ5x5ï¼‰
let create_maze = fn() {
    return [
        ["S", "#", " ", " ", "#"],
        [" ", "#", " ", "#", " "],
        [" ", " ", " ", "#", " "],
        ["#", "#", " ", " ", " "],
        ["#", " ", " ", "#", "G"]
    ];
};

// è¿·è·¯ã®è¡¨ç¤º
let print_maze = fn(maze, player_x, player_y) {
    puts("è¿·è·¯ (S=ã‚¹ã‚¿ãƒ¼ãƒˆ, G=ã‚´ãƒ¼ãƒ«, #=å£, P=ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼):");
    let i = 0;
    while (i < len(maze)) {
        let row_str = "";
        let j = 0;
        while (j < len(maze[i])) {
            if (i == player_y && j == player_x) {
                row_str = row_str + "P ";
            } else {
                row_str = row_str + maze[i][j] + " ";
            };
            j = j + 1;
        };
        puts(row_str);
        i = i + 1;
    };
    puts("");
};

// ç§»å‹•ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
let is_valid_move = fn(maze, x, y) {
    if (x < 0 || y < 0 || y >= len(maze) || x >= len(maze[0])) {
        return false;
    };
    return maze[y][x] != "#";
};

// è¿·è·¯ã‚²ãƒ¼ãƒ 
let maze_game = fn() {
    puts("ğŸ§© è¿·è·¯ã‚²ãƒ¼ãƒ é–‹å§‹!");
    puts("ç›®æ¨™: ã‚¹ã‚¿ãƒ¼ãƒˆ(S)ã‹ã‚‰ã‚´ãƒ¼ãƒ«(G)ã¾ã§ç§»å‹•ã—ã‚ˆã†");
    puts("");
    
    let maze = create_maze();
    let player_x = 0;
    let player_y = 0;
    let moves = ["down", "right", "right", "down", "down", "right", "right"];
    let move_count = 0;
    let max_moves = len(moves);
    
    print_maze(maze, player_x, player_y);
    
    let step = 0;
    while (step < max_moves) {
        let direction = moves[step];
        let new_x = player_x;
        let new_y = player_y;
        
        if (direction == "up") {
            new_y = new_y - 1;
        } else if (direction == "down") {
            new_y = new_y + 1;
        } else if (direction == "left") {
            new_x = new_x - 1;
        } else if (direction == "right") {
            new_x = new_x + 1;
        };
        
        puts("ç§»å‹•: " + direction);
        
        if (is_valid_move(maze, new_x, new_y)) {
            player_x = new_x;
            player_y = new_y;
            move_count = move_count + 1;
            puts("ç§»å‹•æˆåŠŸ! (" + player_x + ", " + player_y + ")");
            
            // ã‚´ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
            if (maze[player_y][player_x] == "G") {
                puts("ğŸ‰ ã‚´ãƒ¼ãƒ«åˆ°é”!");
                puts("ç§»å‹•å›æ•°: " + move_count);
                print_maze(maze, player_x, player_y);
                return true;
            };
        } else {
            puts("ç§»å‹•ä¸å¯! å£ãŒã‚ã‚Šã¾ã™");
        };
        
        print_maze(maze, player_x, player_y);
        step = step + 1;
    };
    
    puts("ğŸ’” ç§»å‹•å›æ•°ä¸Šé™ã«é”ã—ã¾ã—ãŸ");
    return false;
};

puts("è¿·è·¯ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤:");
maze_game();
puts("");

// ===== 5. å˜èªå½“ã¦ã‚²ãƒ¼ãƒ  =====
puts("ã€5. å˜èªå½“ã¦ã‚²ãƒ¼ãƒ ã€‘");
puts("");

let word_guessing_game = fn() {
    puts("ğŸ“ å˜èªå½“ã¦ã‚²ãƒ¼ãƒ é–‹å§‹!");
    
    let words = ["DOG", "CAT", "BIRD", "FISH", "LION"];
    let seed = 456;
    let word_index = pseudo_random(seed, 0, len(words) - 1) % len(words);
    let target_word = words[word_index];
    let word_length = len(target_word);
    
    puts("å˜èªã®é•·ã•: " + word_length + " æ–‡å­—");
    puts("ãƒ’ãƒ³ãƒˆ: å‹•ç‰©ã®åå‰ã§ã™");
    puts("");
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¨æ¸¬ï¼ˆäºˆã‚å®šç¾©ï¼‰
    let guesses = ["CAT", "DOG", "BIRD"];
    let attempts = 0;
    let max_attempts = 3;
    
    while (attempts < max_attempts && attempts < len(guesses)) {
        let guess = guesses[attempts];
        puts("æ¨æ¸¬ " + (attempts + 1) + ": " + guess);
        
        if (guess == target_word) {
            puts("ğŸ‰ æ­£è§£! å˜èªã¯ " + target_word + " ã§ã—ãŸ!");
            return true;
        } else {
            puts("âŒ é•ã„ã¾ã™");
            
            // ãƒ’ãƒ³ãƒˆï¼šä¸€è‡´ã™ã‚‹æ–‡å­—æ•°
            let matching_chars = 0;
            // ç°¡æ˜“å®Ÿè£…ï¼šå®Œå…¨ä¸€è‡´ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ
            if (len(guess) == len(target_word)) {
                matching_chars = 1;  // æ¦‚å¿µçš„ãªå®Ÿè£…
            };
            puts("ãƒ’ãƒ³ãƒˆ: " + matching_chars + " æ–‡å­—ãŒä¸€è‡´ã—ã¦ã„ã¾ã™");
        };
        
        attempts = attempts + 1;
        puts("");
    };
    
    puts("ğŸ’” æ®‹å¿µ! æ­£è§£ã¯ " + target_word + " ã§ã—ãŸ");
    return false;
};

puts("å˜èªå½“ã¦ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤:");
word_guessing_game();
puts("");

// ===== 6. ã‚²ãƒ¼ãƒ çµ±è¨ˆã‚·ã‚¹ãƒ†ãƒ  =====
puts("ã€6. ã‚²ãƒ¼ãƒ çµ±è¨ˆã‚·ã‚¹ãƒ†ãƒ ã€‘");
puts("");

let game_statistics = {
    "games_played": 0,
    "games_won": 0,
    "total_score": 0,
    "best_score": 0,
    "playtime": 0
};

let update_stats = fn(won, score, time) {
    game_statistics["games_played"] = game_statistics["games_played"] + 1;
    
    if (won) {
        game_statistics["games_won"] = game_statistics["games_won"] + 1;
    };
    
    game_statistics["total_score"] = game_statistics["total_score"] + score;
    
    if (score > game_statistics["best_score"]) {
        game_statistics["best_score"] = score;
    };
    
    game_statistics["playtime"] = game_statistics["playtime"] + time;
};

let print_statistics = fn() {
    puts("=== ã‚²ãƒ¼ãƒ çµ±è¨ˆ ===");
    puts("ãƒ—ãƒ¬ã‚¤å›æ•°: " + game_statistics["games_played"]);
    puts("å‹åˆ©å›æ•°: " + game_statistics["games_won"]);
    
    let win_rate = 0;
    if (game_statistics["games_played"] > 0) {
        win_rate = (game_statistics["games_won"] * 100) / game_statistics["games_played"];
    };
    puts("å‹ç‡: " + win_rate + "%");
    
    puts("ç·ã‚¹ã‚³ã‚¢: " + game_statistics["total_score"]);
    puts("æœ€é«˜ã‚¹ã‚³ã‚¢: " + game_statistics["best_score"]);
    puts("ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“: " + game_statistics["playtime"] + " åˆ†");
    
    let avg_score = 0;
    if (game_statistics["games_played"] > 0) {
        avg_score = game_statistics["total_score"] / game_statistics["games_played"];
    };
    puts("å¹³å‡ã‚¹ã‚³ã‚¢: " + avg_score);
};

puts("ã‚²ãƒ¼ãƒ çµ±è¨ˆã®æ›´æ–°:");
update_stats(true, 150, 5);   // å‹åˆ©ã€150ç‚¹ã€5åˆ†
update_stats(false, 80, 3);   // æ•—åŒ—ã€80ç‚¹ã€3åˆ†
update_stats(true, 200, 7);   // å‹åˆ©ã€200ç‚¹ã€7åˆ†

print_statistics();

puts("");
puts("=== ã‚·ãƒ³ãƒ—ãƒ«ã‚²ãƒ¼ãƒ é›†å®Œäº† ===");
puts("æ¥½ã—ã‚“ã§ã„ãŸã ã‘ã¾ã—ãŸã‹? ğŸ®");